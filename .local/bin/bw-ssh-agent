#!/usr/bin/env bash
set -euo pipefail

BW_SESSION=$(bw unlock --raw </dev/tty)
export BW_SESSION

bw list items --session "$BW_SESSION" |
  jq -j '.[] | select(.type == 5) | .sshKey.privateKey + "\u0000"' |
  while IFS= read -r -d '' key; do
    printf '%s\n' "$key" | ssh-add -
  done
